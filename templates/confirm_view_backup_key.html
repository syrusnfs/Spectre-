{% extends "base.html" %}

{% block title %}View Backup Key - Spectre{% endblock %}
{% block page_title %}
    {% if is_admin_view %}
    View Backup Key for {{ user.username }}
    {% else %}
    Backup Key
    {% endif %}
{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header bg-dark text-white">
                <h5 class="mb-0">
                    <i class="bi bi-lock-fill"></i> Backup Key Access
                    {% if is_admin_view %}
                    - {{ user.username }}
                    {% endif %}
                </h5>
            </div>
            <div class="card-body">
                <div class="alert alert-danger">
                    <h6><i class="bi bi-exclamation-triangle-fill"></i> <strong>SENSITIVE INFORMATION</strong></h6>
                    <p class="mb-2">
                        The <strong>Backup Key</strong> is used to encrypt all backups
                        {% if is_admin_view %}
                        for user <strong>{{ user.username }}</strong>
                        {% else %}
                        for your servers
                        {% endif %}.
                    </p>
                    <ul class="mb-0">
                        <li>This key is <strong>critical</strong> for restoring backups</li>
                        <li>Without this key, backups <strong>cannot be decrypted</strong></li>
                        <li>Store it in a <strong>secure password vault</strong></li>
                        {% if is_admin_view %}
                        <li>This action will be <strong>logged in the audit logs</strong></li>
                        {% endif %}
                    </ul>
                </div>

                <div class="alert alert-info">
                    <i class="bi bi-shield-check"></i>
                    <strong>Mandatory 2FA Verification:</strong> Enter the OTP code to view the Backup Key.
                </div>

                <form method="POST" id="viewBackupKeyForm">
                    <div class="mb-4">
                        <label for="otpCode" class="form-label">OTP Code (6 digits) *</label>
                        <input type="text"
                               class="form-control form-control-lg text-center"
                               id="otpCode"
                               name="otp_code"
                               maxlength="6"
                               pattern="[0-9]{6}"
                               placeholder="000000"
                               required
                               style="letter-spacing: 0.5em; font-size: 1.5rem;">
                        <div class="form-text">
                            Enter the code generated by your authenticator app
                        </div>
                    </div>

                    <div class="d-flex justify-content-between">
                        <a href="{% if is_admin_view %}{{ url_for('users.users') }}{% else %}{{ url_for('main.index') }}{% endif %}" class="btn btn-secondary">
                            <i class="bi bi-arrow-left"></i> Cancel
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-eye-fill"></i> View Backup Key
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Allow only numbers in OTP input
document.getElementById('otpCode').addEventListener('input', function(e) {
    this.value = this.value.replace(/[^0-9]/g, '');
});
</script>
{% endblock %}
